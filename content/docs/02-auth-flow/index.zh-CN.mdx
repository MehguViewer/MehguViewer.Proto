---
title: 认证流程
description: MehguViewer 联邦中的身份如何工作。
---

# 认证流程

MehguViewer 使用严格的 **OIDC（OpenID Connect）** 流程来处理身份。这确保用户凭据永远不会接触内容服务器（Core），用户可以在整个联邦中维护单一身份。

## 参与者

1.  **用户（资源所有者）：** 试图访问内容的人。
2.  **客户端（Web/应用）：** 用户使用的界面。
3.  **Auth 服务器（身份提供者）：** 持有用户数据库并颁发令牌的服务器。
4.  **Core 服务器（资源服务器）：** 持有漫画/动画内容的服务器。

## 令牌生命周期

### 1. 登录（授权码流程）
客户端将用户重定向到 Auth 服务器的 `/authorize` 端点。
- 用户在 Auth 服务器上输入凭据。
- Auth 服务器使用 `code` 重定向回客户端。
- 客户端将 `code` 交换为 **访问令牌** 和 **刷新令牌**。

### 2. 访问令牌（JWT）
访问令牌是一个短期的 JSON Web Token（例如，15 分钟）。它包含：
- `sub`：用户 ID。
- `iss`：Auth 服务器 URL。
- `exp`：过期时间。
- `global_level`：用户的等级。

### 3. 发出请求
当客户端从 Core 服务器请求内容时，它在标头中发送访问令牌：

```http
GET /api/v1/series/123 HTTP/1.1
Host: core.mehgu.example.com
Authorization: Bearer <ACCESS_TOKEN>
```

### 4. 验证（无状态）
Core 服务器接收请求。它**不会**联系 Auth 服务器来验证每个请求。相反：
1.  它从 `https://auth.mehgu.example.com/.well-known/jwks.json` 获取 **公钥**（缓存）。
2.  它使用公钥验证 JWT 签名。
3.  它检查令牌是否过期（`exp`）。

如果有效，请求继续进行。

## 安全功能

### 全局屏蔽列表
Auth 服务器维护用户已屏蔽的用户列表。
- **客户端职责：** 客户端获取屏蔽列表（`GET /api/v1/me/relationships`）并在本地过滤掉被屏蔽用户的内容/评论。
- **Core 职责：** 将来，Core 服务器可能会定期同步屏蔽列表以进行服务器端过滤，但目前为了隐私考虑，它是客户端的。

### 会话管理
用户可以通过 `GET /api/v1/sessions` 查看和撤销他们的会话。撤销会话会使 **刷新令牌** 无效，防止颁发新的访问令牌。现有的访问令牌在过期之前仍然有效（短期）。

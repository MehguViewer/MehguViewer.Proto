---
title: 网络策略
description: 联邦网络的强制性标头、CORS 规则和速率限制。
---

# 网络策略

为了确保联邦网络的稳定性和响应速度，所有 MehguViewer 节点（核心节点和认证节点）必须遵守一套严格的网络策略。这些规则管理客户端如何与服务器交互，以及服务器如何保护自己免受滥用。

## 1. 跨域资源共享 (CORS)

由于 MehguViewer Web 客户端是一个单页应用程序 (SPA)，可能托管在与它连接的核心节点不同的域上，因此**必须**在所有公共 API 端点上启用 **CORS**。

### 必需的标头
所有 API 响应**必须**包含以下标头，以允许 Web 客户端获取数据：

-   `Access-Control-Allow-Origin`: `*` (或官方 Web 客户端的特定域)
-   `Access-Control-Allow-Methods`: `GET, POST, PUT, DELETE, OPTIONS`
-   `Access-Control-Allow-Headers`: `Content-Type, Authorization`

## 2. 速率限制

联邦网络容易受到垃圾邮件和拒绝服务攻击。因此，所有公共端点**必须实施速率限制**。

### "429" 规则
客户端**必须**遵守 `429 Too Many Requests` 状态代码。
-   如果客户端收到 429，它**必须**立即停止发送请求。
-   它应该等待 `Retry-After` 标头（如果存在）中指定的持续时间，或使用速率限制标头计算等待时间。
-   **惩罚：** 鼓励服务器永久禁止那些激进地忽略 429 信号的 IP 地址。

### 速率限制标头
为了帮助客户端管理其请求节奏，服务器必须在每个响应中包含这些标头：

| 标头 | 描述 |
| :--- | :--- |
| `X-RateLimit-Limit` | 每个窗口允许的最大请求数（例如，每分钟）。 |
| `X-RateLimit-Remaining` | 当前窗口中剩余的请求数。 |
| `X-RateLimit-Reset` | (可选) 窗口重置时的 UNIX 时间戳。 |

## 3. 性能追踪

为了协助调试分布式网络中的延迟问题，服务器应实施 `Server-Timing` 标头。

```http
Server-Timing: db;dur=53, cache;dur=23.2
```

这允许 Web 客户端显示时间花费的细分（例如，“数据库：53ms”，“缓存：23ms”），而无需暴露敏感的内部细节。
